
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Family Duty Calendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind (Play CDN) -->
  https://cdn.tailwindcss.com</script>

  <!-- React + ReactDOM (development UMD) + Babel Standalone -->
  https://unpkg.com/react@18/umd/react.development.js</script>
  https://unpkg.com/react-dom@18/umd/react-dom.development.js</script>
  https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js</script>

  <style>
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
  <div id="root"></div>

  <!-- IMPORTANT: Babel needs presets for JSX/ESNext or you'll get a white page -->
  <!-- data-presets="env,react" is the critical piece here.  [1](https://www.w3schools.com/css/css_grid.asp) -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useEffect } = React;

    function App() {
      const children = ['Moamen', 'Girls'];
      const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];

      const [selectedChild, setSelectedChild] = useState(children[0]);
      const [selectedDay, setSelectedDay] = useState('Monday');
      const [data, setData] = useState(null);   // contents of schedule.json
      const [error, setError] = useState(null);
      const [showStats, setShowStats] = useState(false);

      useEffect(() => {
        fetch('schedule.json')
          .then(r => r.ok ? r.json() : Promise.reject(new Error('Failed to load schedule.json')))
          .then(j => setData(j))
          .catch(e => setError(e));
      }, []);

      // Helpers
      function getTasks(day, child) {
        if (!data) return [];
        const entries = (data[child]?.[day] || []);
        // sort by time if possible
        const toMinutes = (t) => {
          const m = (t || '').match(/(\d{1,2}):(\d{2})(?:\s*(AM|PM))?/i);
          if (!m) return 0;
          let h = parseInt(m[1],10), min = parseInt(m[2],10), ap = m[3];
          if (ap) { if (ap.toUpperCase()==='PM' && h < 12) h += 12; if (ap.toUpperCase()==='AM' && h===12) h = 0; }
          return h*60 + min;
        };
        return [...entries].sort((a,b) => toMinutes(a.time) - toMinutes(b.time));
      }

      function getStats(child) {
        if (!data) return { completed:0, total:0, percentage:0 };
        let total = 0, completed = 0;
        days.forEach(d => {
          const ts = data[child]?.[d] || [];
          total += ts.length;
          completed += ts.filter(x => x.task && x.task.toLowerCase() !== 'free').length;
        });
        const pct = total > 0 ? Math.round((completed/total)*100) : 0;
        return { completed, total, percentage: pct };
      }

      if (error) {
        return <div className="max-w-3xl mx-auto bg-white p-4 rounded-lg shadow">Error: {String(error)}</div>;
      }
      if (!data) {
        return <div className="max-w-3xl mx-auto bg-white p-4 rounded-lg shadow">Loading schedule‚Ä¶</div>;
      }

      return (
        <div className="max-w-4xl mx-auto">
          {/* Header */}
          <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 className="text-3xl font-bold text-indigo-900 mb-2 flex items-center gap-2">
              <span className="text-2xl">üìÖ</span> Family Duty Calendar
            </h1>
            <p className="text-gray-600">Built from your Excel data (Moamen & Girls)</p>
          </div>

          {/* Who's viewing */}
          <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div className="flex items-center gap-2 mb-3">
              <span className="text-indigo-600">üë§</span>
              <span className="font-semibold text-gray-700">Who's viewing?</span>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
              {['Parent', ...children].map(label => (
                <button
                  key={label}
                  onClick={() => { setSelectedChild(label==='Parent' ? 'Parent' : label); setShowStats(false); }}
                  className={`p-3 rounded-lg font-medium transition ${
                    selectedChild === label
                      ? 'bg-indigo-600 text-white'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {label === 'Parent' ? 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent' : label}
                </button>
              ))}
            </div>
          </div>

          {/* Parent stats */}
          {selectedChild === 'Parent' && (
            <>
              <div className="bg-white rounded-lg shadow-lg p-4 mb-6 flex gap-3">
                <button
                  onClick={() => setShowStats(!showStats)}
                  className="flex-1 bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 transition"
                >
                  {showStats ? 'Hide Statistics' : 'View Statistics'}
                </button>
              </div>

              {showStats && (
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span>üèÜ</span> Weekly Progress
                  </h2>
                  <div className="grid md:grid-cols-2 gap-4">
                    {children.map(ch => {
                      const s = getStats(ch);
                      return (
                        <div key={ch} className="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-lg p-4 border-2 border-indigo-200">
                          <h3 className="font-bold text-lg text-indigo-900 mb-2">{ch}</h3>
                          <div className="text-3xl font-bold text-indigo-600 mb-2">{s.percentage}%</div>
                          <div className="text-sm text-gray-600">{s.completed} of {s.total} planned slots</div>
                          <div className="w-full bg-gray-200 rounded-full h-2 mt-3">
                            <div className="bg-indigo-600 h-2 rounded-full transition-all duration-300" style={{ width: `${s.percentage}%` }} />
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </>
          )}

          {/* Day selection */}
          <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div className="flex overflow-x-auto gap-2 pb-2">
              {days.map(day => (
                <button
                  key={day}
                  onClick={() => setSelectedDay(day)}
                  className={`flex-shrink-0 px-4 py-3 rounded-lg font-medium transition ${
                    selectedDay === day
                      ? 'bg-indigo-600 text-white'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {day}
                </button>
              ))}
            </div>
          </div>

          {/* Tasks */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span>‚è∞</span>
              {selectedDay} ‚Äî {selectedChild === 'Parent' ? 'All Tasks' : `${selectedChild}'s Tasks`}
            </h2>

            <div className="space-y-3">
              {selectedChild === 'Parent'
                ? children.map(ch => (
                    <div key={ch} className="border-l-4 border-indigo-400 pl-4 mb-4">
                      <h3 className="font-bold text-lg text-indigo-900 mb-2">{ch}</h3>
                      {getTasks(selectedDay, ch).map((item, i) => (
                        <div key={i} className="flex items-center gap-3 p-3 rounded-lg mb-2 bg-gray-50 border-2 border-gray-200">
                          <div className="flex-shrink-0 w-20 text-sm font-medium text-indigo-600">{item.time}</div>
                          <div className="flex-1 text-gray-800">{item.task}</div>
                        </div>
                      ))}
                    </div>
                  ))
                : getTasks(selectedDay, selectedChild).map((item, i) => (
                    <div key={i} className="flex items-center gap-3 p-4 rounded-lg bg-gray-50 border-2 border-gray-300">
                      <div className="flex-shrink-0 w-20 text-sm font-bold text-indigo-600">{item.time}</div>
                      <div className="flex-1 font-medium text-gray-800">{item.task}</div>
                    </div>
                  ))}
            </div>
          </div>

          <div className="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
            <div className="flex items-start gap-2">
              <span className="flex-shrink-0 mt-0.5">‚ÑπÔ∏è</span>
              <div className="text-sm text-blue-800">
                <strong>Tip:</strong> To update the data, replace <code>schedule.json</code> with a new export.
              </div>
            </div>
          </div>
        </div>
      );
    }

       ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
